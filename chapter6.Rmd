# Rstudio exercise 6

The task in the Rstudio exercise 6 is to repeat the analyses done in chapters 8 and 9 of MABS (Vehkalahti and Everitt, 2019), but use the two datasets in reverse order. In chapter 8 of MABS, the analyses are done with BPRS data, but in this exercise we implepent the analyses using RATS data. Similarly, we implent the analyses of chapter 9 of MABS using the BPRS data even though they were originally done with BPRS data.

## The analyses of Chapter 8 of MABS using RATS data

``` {r, warning=FALSE, message=FALSE}
# accessing the data and re-converting ID and Group as factors

RATS <- read.table("https://raw.githubusercontent.com/KimmoVehkalahti/MABS/master/Examples/data/rats.txt", sep = '\t', header = T)

RATS$ID <- factor(RATS$ID)
RATS$Group <- factor(RATS$Group)

RATSL <- read.csv(file="~/GitHub/IODS-project/data/RATSL.csv")

RATSL$ID <- factor(RATSL$ID)
RATSL$Group <- factor(RATSL$Group)
```


``` {r, message=FALSE, warning= FALSE}
library(ggplot2)

# Drawing the figure 8.1 using RATS data
ggplot(RATSL, aes(x = Time, y = Weight, linetype = ID)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ Group, labeller = label_both) +
  theme(legend.position = "none") + 
  scale_y_continuous(limits = c(min(RATSL$Weight), max(RATSL$Weight)))
```

##### **FIGURE 8.1** Individual growth by diet (Group) for the RATS data

In the Figure 8.1 all weights from all time points are plotted separately for each diet group. Each line represents one rat. It can easily be seen, that the baseline weight in Group 1 is a lot lower compared to groups 2 and 3. The rats in group 1 also don's seem to grow much. The lines in each group seem very aligned, so there is not much invidiual variablitiy.

In next plot (Figure 8.2) the standardized values of each observation are plotted. The standardiced values were calculated by subtracting the relevant occasion mean from the original observation and then dividing by the corresponding visit standard deviation. From the scaled plot, the effect of the baseline value is more easily seen, and now we see some individual variablity more clearly. For example, the solid line in Group 2 has quite high weight at baseline and a bit slower groth compared to other rats in that group. In the plot using standardized values, the standardized weight recreases rather than increases.

```{r, warning=FALSE, message = FALSE}
library(dplyr)

# Standardising the weight
RATSL <- RATSL %>%
  group_by(Time) %>%
  mutate(stdWeight = (Weight - mean(Weight))/sd(Weight) ) %>%
  ungroup()

# Plotting again with the standardised weight
ggplot(RATSL, aes(x = Time, y = stdWeight, linetype = ID)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ Group, labeller = label_both) +
  theme(legend.position = "none") +
  scale_y_continuous(name = "standardized weight")
```

##### **FIGURE 8.2** Individual growth by diet for RATS data after standardization.

```{r, message=FALSE, warning=FALSE}
library(tidyr)

# Number of timepoints, baseline included
n <- RATSL$Time %>% unique() %>% length()

# Summary data with mean and standard error of bprs by treatment and week 
RATSL_summary <- RATSL %>%
  group_by(Group, Time) %>%
  summarise( mean = mean(Weight), se = sd(Weight)/sqrt(n) ) %>%
  ungroup()

# Plot the mean profiles
ggplot(RATSL_summary, aes(x = Time, y = mean, linetype = Group, shape = Group)) +
  geom_line() +
  scale_linetype_manual(values = c(1,2,3)) +
  geom_point(size=3) +
  scale_shape_manual(values = c(1,2,3)) +
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se, linetype="1"), width=0.3) +
  theme(legend.position = c(0.9,0.5)) +
  scale_y_continuous(name = "mean(bprs) +/- se(bprs)")
```

##### **FIGURE 8.3** Mean growth for the diets in the RATS data.

In the Figure 8.3 the mean growth for the three diet groups is presented. Same can be seen here as earlier, the mean weight of rats in Group 1 is lower, as well as the mean growth rate seems to be lower. Other approach to plot summaries is to use boxplots (Figure 8.4). 

```{r, message=FALSE, warning=FALSE}
#Drawing the figure 8.4 using RATS data

ggplot(RATSL, aes(x = factor(Time), y = Weight, fill = Group))+ 
  geom_boxplot(position = position_dodge(width = 0.9)) +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  theme(legend.position = c(0.9,0.4)) +
  scale_x_discrete(name = "Time") +
  scale_y_continuous(name = "Weight") +
  scale_fill_grey(start = 0.5, end = 1)
```

##### **FIGURE 8.4** Boxplots for summaries of weight for the diets at each time point in the RATS data.

Boxplots gives also a possiblity to identify outliers. In group 2 there is one rat with considerable higher weight than others which can bee seen from the figure 8.5 where mean weights of each rat at all timepoints after baseline are plotted. I'm quite hesitant to identify this rat as an otlier, because the weight is clearly at possible range and from the earlier figures we see that the growth of this heavy rat is similar compared to other is that group. However, for educational purposes, I filter out this rat and draw the figure 8.6 without it.

```{r, message=FALSE, warning=FALSE}
#Drawing the figure 8.5 using RATS data

RATSL_summary2<- RATSL %>%
  filter(Time > 1) %>%
  group_by(Group, ID) %>%
  summarise(mean=mean(Weight) ) %>%
  ungroup()

ggplot(RATSL_summary2, aes(x = Group, y = mean)) +
  geom_boxplot() +
  stat_summary(fun.y = "mean", geom = "point", shape=23, size=4, fill = "white") +
  scale_y_continuous(name = "mean(Weight), all time points after baseline")
```

##### **FIGURE 8.5** Boxplots of mean weight for the diet groups in the RATS data.

```{r, message=FALSE, warning=FALSE}
# Filtering out the heavy rat in group 2 and drawing the figure 8.6
RATSL_summary2F <- RATSL_summary2 %>% filter (mean <560)

ggplot(RATSL_summary2F, aes(x = Group, y = mean)) +
  geom_boxplot() +
  stat_summary(fun.y = "mean", geom = "point", shape=23, size=4, fill = "white") +
  scale_y_continuous(name = "mean(Weight), all time points after baseline")
```

##### **FIGURE 8.6** Boxplots of mean weight for the diet groups in the RATS data without an outlier (a heavy rat in Group 2).

The differences between diet groups can't be tested with t-test as was done in chapter 8 for BPRS data, because t-test can only deal with two groups. The analysis of covariance (TAble 8.4) is possible. From the ANCOVA table (Table 8.4) we see that the mean weights in diet groups are not different when the baseline weight is taken into account (p=0.076).

##### **TABLE 8.4** Results from an analysis of covariance of the RATS Data with Baseline Weight and diet group covariates
```{r, message=FALSE, warning=FALSE}
# Add the baseline weight from the original data as a new variable to the summary data:
RATSL_summary2b <- RATSL_summary2 %>%
  mutate(baseline = RATS$WD1)
# Fit the ANCOVA model and see the results:
fit <- lm(mean ~ baseline + Group, data = RATSL_summary2b)
anova(fit)
```
